<div id="comments"></div>
<script>
(function() {
  // Configuration pulled from your Hugo params
  const {
    repo: utterancesRepo,
    issueTerm: utterancesIssueTerm,
    label: utterancesLabel,
    theme: lightTheme,
    darkTheme: darkThemeName,
    crossorigin: scriptCrossOrigin
  } = {
    repo: "{{ .Site.Params.utterances.repo }}",
    issueTerm: "{{ .Site.Params.utterances.issueTerm }}",
    label: "{{ .Site.Params.utterances.label }}",
    theme: "{{ .Site.Params.utterances.theme }}",
    darkTheme: "{{ .Site.Params.utterances.darkTheme }}",
    crossorigin: "{{ .Site.Params.utterances.crossorigin }}"
  };

  // Renders (or re-renders) the Utterances comment widget
  const initializeCommentsWidget = () => {
    const selectedTheme = 
      localStorage.getItem("pref-theme") === "dark" 
        ? darkThemeName 
        : lightTheme;

    const scriptElement = document.createElement("script");
    Object.assign(scriptElement, {
      src: "https://utteranc.es/client.js",
      async: true,
      crossOrigin: scriptCrossOrigin
    });
    scriptElement.setAttribute("repo", utterancesRepo);
    scriptElement.setAttribute("issue-term", utterancesIssueTerm);
    scriptElement.setAttribute("label", utterancesLabel);
    scriptElement.setAttribute("theme", selectedTheme);

    const commentsContainer = document.getElementById("comments");
    commentsContainer.innerHTML = "";
    commentsContainer.appendChild(scriptElement);
  };

  document.addEventListener("DOMContentLoaded", () => {
    initializeCommentsWidget();
    document.querySelector(".logo-switches")
      ?.addEventListener("click", () => setTimeout(initializeCommentsWidget, 100));
  });
})();
</script>
